<div class="row anu-container">
  <div class="col-12 bg-white" style="position:sticky;top:80px;z-index:1040;">
    <div class="row">
      <ng-container *ngFor="let section of currentReport.reportDetails.sections">
        <ng-container *ngIf="action === getCleanText(section)">
          <h4 class="col-8 text-left my-3 section-header">{{section.sectionName}}</h4>
          <div class="col-3" style="display:flex; align-items: center;justify-content:flex-end;">
            <a *ngIf="(currentReport.canManage && !currentReport.forGranteeUse)" (click)="addNewFieldToSection(section.id,section.sectionName)"
               class="btn btn-sm btn-green">Add a Field<i class="fa fa-plus-square ml-2"></i></a>
          </div>
        </ng-container>
      </ng-container>
      <div class="col-1 text-right" style="display: flex;align-items: center;justify-content: flex-start;">
        <!--<button *ngIf="canManage" class="btn btn-sm btn-green float-right">
          <i class="fas fa-plus-square mr-2"></i>Add new Section</button>-->
        <mat-icon mat-button [matMenuTriggerFor]="menu" class="float-right" style="cursor:pointer;">more_vert</mat-icon>
        <mat-menu #menu="matMenu">
          <ng-container *ngFor="let section of currentReport.reportDetails.sections">
            <ng-container *ngIf="action === getCleanText(section)">
              <button *ngIf="(currentReport.canManage && !currentReport.forGranteeUse)" mat-menu-item (click)="editSection(section)">Edit Section name</button>
              <button *ngIf="(currentReport.canManage && !currentReport.forGranteeUse)" mat-menu-item (click)="deleteSection(section.id,'Delete section ' + section.sectionName + '?')">Delete Section</button>
                <button  mat-menu-item (click)="showHistory('report',currentReport)"><mat-icon class="ml-1">comment</mat-icon>Notes</button>
                <button mat-menu-item (click)="showWorkflowAssigments()"><mat-icon class="ml-1">assignment</mat-icon>Assignments</button>
              <ng-container>
                <hr>
                <button mat-menu-item (click)="manageGrant()"><img class="ml-2 mr-3" style="width:20px;height:20px;" src="./assets/img/dp.svg">View Grant</button>
              </ng-container>
            </ng-container>
          </ng-container>
        </mat-menu>
      </div>
    </div>
  </div>
  <div class="col-lg-12">
    <div #container class="container text-left mt-2 px-3 py-2">

      <div *ngIf="!currentReport.canManage">
        <div class="row">
          <ng-container *ngFor="let section of currentReport.reportDetails.sections">
            <div *ngIf="action === getCleanText(section)" [disabled]="true">
              <h4 class="text-header-light">
                {{section.sectionName}}
              </h4>
              <ng-container *ngFor="let attribute of section.attributes">
                <ng-container *ngIf="attribute.fieldType==='text' || attribute.fieldType==='multiline'">
                  <b>{{attribute.fieldName}}</b>
                  <div>{{attribute.fieldValue}}</div>
                </ng-container>
                <ng-container *ngIf="attribute.fieldType==='kpi'" class="mb-2">
                  <div class="col-sm-12 col-lg-12 text-left mb-3">
                    <div class="row mx-2">
                      <mat-form-field>
                        <input matInput class="col-3" [value]="attribute.fieldName" placeholder="KPI">
                      </mat-form-field>
                      <mat-form-field>
                        <input matInput class="col-3" [value]="attribute.target" placeholder="Target/Goal">
                      </mat-form-field>
                      <mat-form-field>
                        <input matInput class="col-3" [value]="attribute.frequency" placeholder="Frequency">
                      </mat-form-field>
                    </div>
                  </div>
                </ng-container>
                <ng-container *ngIf="attribute.fieldType=='table'">
                  <div class="col-sm-12 col-lg-12 mb-3">
                    {{attribute.fieldName}}
                    <div id="attribute_{{attribute.id}}" class="mt-1" [innerHtml]="getTabularData(attribute.id,attribute.fieldValue)"></div>
                  </div>
                </ng-container>
                <mat-nav-list>
                  <ng-container *ngIf="attribute.fieldType==='document'">
                    <mat-list-item>
                      <ng-container *ngFor="let doc of getDocumentName(attribute.fieldValue)">

                            <span class="ml-3">
                                <ng-container *ngIf="doc.type === 'pdf'">
                                    <i class="fas fa-file-pdf text-danger"></i>
                                </ng-container>
                                <ng-container *ngIf="doc.type === 'xls' || doc.type === 'xlsx'">
                                    <i class="fas fa-file-excel text-success"></i>
                                </ng-container>
                                <ng-container *ngIf="doc.type === 'doc' || doc.type === 'docx'">
                                    <i class="fas fa-file-word text-primary"></i>
                                </ng-container>
                            {{doc.name}}</span>
                      </ng-container>
                    </mat-list-item>

                  </ng-container>
                </mat-nav-list>
              </ng-container>
            </div>
          </ng-container>
        </div>
        <hr>
      </div>
      <!--MANAGEMENT SECTION-->
      <div *ngIf="currentReport.canManage">
        <mat-form-field style="height:0;">
        <input matInput [matDatepicker]="datePicker" (dateInput)="setDate($event)">
        <mat-datepicker #datePicker></mat-datepicker>
        </mat-form-field>
        <div class="row">
          <div class="col-12">
            <ng-container *ngFor="let section of currentReport.reportDetails.sections">
              <div *ngIf="action === getCleanText(section)">
                <div>
                  <ng-container #sectionsContainer *ngFor="let attribute of section.attributes; let i=index">
                    <div id="fieldBlock_{{attribute.id}}" class="row mb-4 mt-2" style="border:1px solid #ececec;border-radius:4px; padding: 20px; background: #FCFCFC;">
                      <ng-container class="mb-2">
                        <div class="col-sm-4 col-lg-8" *ngIf="attribute.fieldType==='multiline' && (currentReport.canManage && !currentReport.forGranteeUse)">
                          <mat-form-field>
                            <input id="field_{{attribute.id}}" [(ngModel)]="attribute.fieldName"  class="anu-input"
                                   [ngModelOptions]="{standAlone:true}"
                                   
                                   matInput placeholder="Title">
                          </mat-form-field>

                        </div>
                        <div class="col-sm-4 col-lg-8" *ngIf="attribute.fieldType==='multiline' && (currentReport.canManage && currentReport.forGranteeUse)">
                          <label>Title:</label>
                          <p>{{attribute.fieldName}}</p>
                        </div>
                        <div class="col-sm-4 col-lg-8" *ngIf="attribute.fieldType==='document'">
                          <mat-form-field *ngIf="(currentReport.canManage && !currentReport.forGranteeUse)">

                            <input id="field_{{attribute.id}}" [(ngModel)]="attribute.fieldName"  class="anu-input"
                                   [ngModelOptions]="{standAlone:true}"
                                   
                                   matInput placeholder="Title">
                          </mat-form-field>
                          <label *ngIf="(currentReport.canManage && currentReport.forGranteeUse) || !currentReport.canManage">Title:</label>
                          <p class="anu-input" *ngIf="(currentReport.canManage && currentReport.forGranteeUse) || !currentReport.canManage" style="background:#F0F1F0 !important;">{{attribute.fieldName}}</p>
                        </div>
                        <div class="col-sm-4 col-lg-8" *ngIf="attribute.fieldType==='text'">
                          <mat-form-field>

                            <input id="field_{{attribute.id}}" [(ngModel)]="attribute.fieldName"  class="anu-input"
                                   [ngModelOptions]="{standAlone:true}"
                                   
                                   matInput placeholder="Title">
                          </mat-form-field>
                        </div>
                        <div class="col-sm-8 col-lg-8" *ngIf="attribute.fieldType==='table'">
                          <mat-form-field *ngIf="(currentReport.canManage && !currentReport.forGranteeUse)">

                            <input  id="field_{{attribute.id}}" [(ngModel)]="attribute.fieldName"  class="anu-input"
                                    [ngModelOptions]="{standAlone:true}"
                                    
                                    matInput placeholder="Title">
                          </mat-form-field>
                          <label *ngIf="(currentReport.canManage && currentReport.forGranteeUse) || !currentReport.canManage">Title:</label>
                          <p class="anu-input" *ngIf="(currentReport.canManage && currentReport.forGranteeUse) || !currentReport.canManage" style="background:#F0F1F0 !important;">{{attribute.fieldName}}</p>
                        </div>

                        <div class="col-sm-8 col-lg-8" *ngIf="attribute.fieldType==='disbursement'">
                          <mat-form-field *ngIf="(currentReport.canManage && !currentReport.forGranteeUse)">

                            <input  id="field_{{attribute.id}}" [(ngModel)]="attribute.fieldName"  class="anu-input"
                                    [ngModelOptions]="{standAlone:true}"

                                    matInput placeholder="Title">
                          </mat-form-field>
                          <mat-form-field *ngIf="(currentReport.canManage && currentReport.forGranteeUse) || !currentReport.canManage">
                            <input  id="field_{{attribute.id}}" [(ngModel)]="attribute.fieldName"  class="anu-input"
                                    [ngModelOptions]="{standAlone:true}"
                                    style="background:#F0F1F0 !important;"
                                    matInput placeholder="Title" readonly disabled>
                          </mat-form-field>
                        </div>


                        <div class="col-sm-4 col-lg-8" *ngIf="attribute.fieldType==='kpi' && (currentReport.canManage && !currentReport.forGranteeUse) && attribute.canEdit">
                          <mat-form-field>
                            <input [(ngModel)]="attribute.fieldName"  class="anu-input"
                                   [ngModelOptions]="{standAlone:true}"
                                   
                                   matInput placeholder="Title">
                          </mat-form-field>

                        </div>
                        <div class="col-sm-4 col-lg-8" *ngIf="attribute.fieldType==='kpi' && (currentReport.canManage && !currentReport.forGranteeUse) && !attribute.canEdit">

                          <mat-form-field>
                            <input [(ngModel)]="attribute.fieldName"  class="anu-input"
                                   [ngModelOptions]="{standAlone:true}" disabled readonly
                                   style="background:#F0F1F0 !important;"
                                   matInput placeholder="Title">
                          </mat-form-field>

                        </div>
                        <div class="col-sm-4 col-lg-8" *ngIf="attribute.fieldType==='kpi' && (currentReport.canManage && currentReport.forGranteeUse)">

                          <mat-form-field>
                            <input [(ngModel)]="attribute.fieldName"  class="anu-input"
                                   [ngModelOptions]="{standAlone:true}" readonly disabled
                                   style="background:#F0F1F0 !important;"
                                   matInput placeholder="Title">
                          </mat-form-field>

                        </div>
                        <div class="col-sm-4 col-lg-4 text-left" *ngIf="(currentReport.canManage && !currentReport.forGranteeUse) && attribute.canEdit">
                          <mat-form-field >
                            <mat-label>Type</mat-label>
                            <mat-select (selectionChange)="handleTypeChange($event,attribute,section)" [ngModel]="attribute.fieldType"  class="anu-input"
                                        [ngModelOptions]="{standAlone:true}">
                              <mat-option value="multiline" >Descriptive</mat-option>
                              <mat-option value="kpi">Measurement/KPI</mat-option>
                              <mat-option value="table">Tablular</mat-option>
                              <mat-option value="document">Document</mat-option>
                              <mat-option value="disbursement" [disabled]="checkAbilityToAddDisbursements()">Disbursement</mat-option>
                              <!--mat-op
                              <!--mat-op
                              <!--mat-option value="document">Document</mat-option-->
                            </mat-select>
                            <!--mat-select *ngIf="!attribute.canEdit" [(ngModel)]="attribute.fieldType"  class="anu-input"
                                        [ngModelOptions]="{standAlone:true}" (click)="changeFieldType()" (blur)="selectionClosed()"
                                        (ngModelChange)="handleTypeChange($event,attribute,section)" disabled readonly style="background:#F0F1F0 !important;">
                              <mat-option value="none" aria-selected="true">--Select type
                                of field--
                              </mat-option>
                              <mat-option value="multiline">Descriptive</mat-option>
                              <mat-option value="kpi">Measurement/KPI</mat-option>
                              <mat-option value="table">Tablular</mat-option>
                              <mat-option value="document">Document</mat-option>
                            </mat-select-->

                          </mat-form-field>
                          <label *ngIf="(currentReport.canManage && currentReport.forGranteeUse) || !currentReport.canManage">Type:</label>
                          <p class="anu-input" *ngIf="(currentReport.canManage && currentReport.forGranteeUse) || !currentReport.canManage" style="background:#F0F1F0 !important;">{{getFieldTypeDisplayValue(attribute.fieldType)}}</p>
                        </div>

                        <div class="col-sm-4 col-lg-4 text-left" *ngIf="(currentReport.canManage && !currentReport.forGranteeUse) && !attribute.canEdit">
                          <mat-form-field>
                            <input matInput placeholder="Type:" disabled readonly class="anu-input" style="background:#F0F1F0 !important;" [value]="getFieldTypeDisplayValue(attribute.fieldType)">
                          </mat-form-field>
                        </div>
                        <div class="col-sm-4 col-lg-4 text-left" *ngIf="(currentReport.canManage && currentReport.forGranteeUse)">
                          <mat-form-field>
                            <input matInput placeholder="Type:" disabled readonly class="anu-input" style="background:#F0F1F0 !important;" [value]="getFieldTypeDisplayValue(attribute.fieldType)">
                          </mat-form-field>
                        </div>
                        <div class="col-sm-3 col-lg-3 text-left" *ngIf="attribute.fieldType==='text'">
                          <mat-form-field>
                            <input matInput [(ngModel)]="attribute.fieldValue" class="anu-input"

                                   [ngModelOptions]="{standAlone:true}"
                                   placeholder="Field Value"
                                   >
                          </mat-form-field>
                        </div>
                        <div class="col-sm-12 col-lg-11 text-left" *ngIf="attribute.fieldType==='table'">
                          <div class="row"><div class="col-12 text-right">
                            <span *ngIf="(currentReport.canManage && !currentReport.forGranteeUse)" (click)="addColumn(attribute)" style="cursor:pointer;"><i class="fas fa-plus-circle text-green mr-1"></i>Add a column</span>
                          </div>
                            <div style="margin-left:250px;"><i (click)="moveColsRight()" class="fas fa-arrow-alt-circle-left mr-3"></i><i (click)="moveColsLeft()" class="fas fa-arrow-alt-circle-right"></i></div>
                          </div>
                          <div id="tableArea" class="row flex-row flex-nowrap" style="overflow: hidden;overflow-x: scroll;">
                            <table id="tablePlaceholder">
                              <tr>
                                <td width="20%" style="min-width:250px;position: sticky; left: 0; z-index: 1;background: rgb(244,244,244)">&nbsp;</td>
                                <ng-container *ngFor="let column of attribute.fieldTableValue[0].columns, let i = index">

                                  <td style="border: 1px solid #e4e4e4;">

                                    <mat-form-field *ngIf="(currentReport.canManage && !currentReport.forGranteeUse)">
                                      <mat-icon  *ngIf="(currentReport.canManage && !currentReport.forGranteeUse)" (click)="deleteColumn(section.id,attribute.id,i)"
                                                 aria-hidden="false" style="font-size:18px;position: relative; left: 90%;z-index:0;cursor:pointer;top:3px;"
                                                 aria-label="Example home icon" inline="false" title="Delete this column">
                                        delete_outline
                                      </mat-icon>
                                      <label>Column Description</label>
                                      <input id="column_{{column.id}}" matInput [(ngModel)]="column.name" class="anu-input"
                                             [ngModelOptions]="{standAlone:true}">
                                    </mat-form-field>
                                    <p class="anu-input-plain" *ngIf="(currentReport.canManage && currentReport.forGranteeUse) || !currentReport.canManage" style="background:#F0F1F0 !important;">{{column.name}}</p>
                                  </td>

                                </ng-container>
                              </tr>
                              <ng-container *ngFor="let row of attribute.fieldTableValue, let i = index">
                                <tr>
                                  <td width="20%" style="position: sticky; left: 0; z-index: 1;background: rgb(244,244,244)">
                                    <mat-form-field *ngIf="(currentReport.canManage && !currentReport.forGranteeUse)">
                                      <mat-icon *ngIf="(currentReport.canManage && !currentReport.forGranteeUse)" (click)="deleteRow(section.id,attribute.id,i)"
                                                aria-hidden="false" style="font-size:18px;top: 25px; position: relative; left: 90%;z-index:1;cursor:pointer;"
                                                aria-label="Example home icon" inline="false" title="Delete this row">
                                        delete_outline
                                      </mat-icon>
                                      <label style="width: 100%;position: relative;text-align: center;">Row Description</label>
                                    <textarea matInput [(ngModel)]="row.name" class="anu-input" style="height:80px !important;"
                                              [ngModelOptions]="{standAlone:true}"></textarea>
                                    </mat-form-field>
                                    <p class="anu-input-plain" *ngIf="(currentReport.canManage && currentReport.forGranteeUse) || !currentReport.canManage" style="background:#F0F1F0 !important;">{{row.name}}</p>
                                  </td>
                                  <ng-container *ngFor="let column of row.columns">
                                    <td style="border: 1px solid #e4e4e4;min-width:200px;padding-top:0;">
                                      <mat-form-field>
                                        <input matInput [(ngModel)]="column.value" class="anu-input"
                                               [ngModelOptions]="{standAlone:true}"
                                               placeholder="Value"
                                               >
                                      </mat-form-field>
                                    </td>
                                  </ng-container>
                                </tr>
                              </ng-container>
                            </table>
                          </div>
                          <div class="row"><div class="col-12">
                            <span *ngIf="(currentReport.canManage && !currentReport.forGranteeUse)" (click)="addRow(attribute)" style="cursor:pointer;"><i class="fas fa-plus-circle text-green mr-1"></i>Add a row</span>
                          </div></div>

                        </div>
                        <div class="col-sm-12 col-lg-12 text-left" *ngIf="attribute.fieldType==='disbursement'">
                            <div id="tableArea" class="row" style="padding-left:15px;padding-right:15px;">
                              <ng-container *ngIf="getGrantDisbursementAttribute()">
                              <table id="tablePlaceholderX" width="100%">
                                <tr style="background: #f9f9f9">
                                  <td align="center" valign="middle" width="10%" style="border: 1px solid #e4e4e4;">
                                    <label class="m-0"><span>Planned Installment #</span></label>
                                  </td>
                                  <ng-container *ngFor="let column of getGrantDisbursementAttribute().fieldTableValue[0].columns, let i = index">
                                    <td align="center" valign="middle" style="border: 1px solid #e4e4e4;" width="10%">
                                      <label class="m-0 text-center p-2 m-0" style="font-weight:400;font-size:14px;">{{column.name}}</label>
                                    </td>
                                  </ng-container>
                                </tr>
                                <ng-container *ngFor="let row of getGrantDisbursementAttribute().fieldTableValue, let i = index">
                                  <tr>
                                    <td width="10%">
                                      <p class="anu-input m-0 text-center" style="background:#f4f4f4 !important;"><label class="w-100 m-0">{{row.name}}</label></p>
                                    </td>
                                    <ng-container *ngFor="let column of row.columns,let j = index">
                                      <td [width]="column.name==='Notes'?'20%':'12%'">
                                          <p *ngIf="!column.dataType" class="anu-input m-0 w-100 m-0" style="background:#f4f4f4 !important;">{{column.value}}</p>
                                          <p *ngIf="column.dataType==='currency'" class="anu-input w-100 text-right m-0" style="background:#f4f4f4 !important;">{{getFormattedCurrency(column.value)}}</p>
                                      </td>
                                    </ng-container>
                                  </tr>
                                </ng-container>
                                <tr *ngIf="getGrantDisbursementAttribute().fieldTableValue.length>1" style="background:#f4f4f4;">
                                  <td class="py-2" align="center" style="position: sticky; left: 0; z-index: 1;"><label  class="w-100" style="font-weight:600;">GRANT TOTALS:</label></td>
                                  <td *ngFor="let column of getGrantDisbursementAttribute().fieldTableValue[0].columns,let j = index" valign="middle">
                                    <label class="text-right pr-3 my-0 w-100" *ngIf="column.dataType==='currency'"><b>{{getTotals(j,getGrantDisbursementAttribute().fieldTableValue)}}</b></label>
                                  </td>
                                </tr>
                                <!--tr *ngIf="getGrantDisbursementAttribute().fieldTableValue.length>1" style="background:#f4f4f4;">
                                  <td align="center" style="position: sticky; left: 0; z-index: 1;"><b>Committed Grant Amount:</b></td>
                                  <td *ngFor="let column of getGrantDisbursementAttribute().fieldTableValue[0].columns,let j = index" valign="middle">
                                    <p class="text-right pr-3 my-0" *ngIf="column.dataType==='currency'"><b>{{getCommittedGrantTotals(j)}}</b></p>
                                  </td>
                                </tr-->
                              </table>
                              </ng-container>
                            </div>

                     


                          <div id="tableArea" class="row dibursements-class mt-4" style="padding-left:15px;padding-right:15px;">
                            <table #dataColumns id="tablePlaceholder" width="100%">
                              <tr>
                                <ng-container *ngIf="attribute.fieldTableValue">
                                <td align="center" valign="middle" width="10%" style="background: rgb(244,244,244);border: 1px solid #e4e4e4;">
                                  <label class="m-0">#</label>
                                </td>
                                </ng-container>
                                <ng-container *ngIf="attribute.fieldTableValue">
                                <ng-container *ngFor="let column of attribute.fieldTableValue[0].columns, let i = index">

                                  <td align="center" valign="middle" style="border: 1px solid #e4e4e4;" width="10%">
                                    <label class="m-0 text-center p-2" style="font-weight:400;font-size:14px;">{{column.name}}</label>
                                  </td>
                                </ng-container>
                                </ng-container>
                              </tr>
                              <ng-container *ngIf="attribute.fieldTableValue">
                              <ng-container *ngFor="let row of attribute.fieldTableValue, let i = index">
                                <tr>
                                  <td width="10%" style="background: rgb(244,244,244);padding:2px 4px;border: 1px solid #e4e4e4;">
                                    <mat-icon *ngIf="attribute.fieldTableValue.length>1 && currentReport.forGranteeUse && row.enteredByGrantee && row.status" (click)="deleteDisbursementRow(section.id,attribute.id,i)"
                                              aria-hidden="false" style="font-size:12px;top: -3px; position: relative; left: 88%;z-index:1;cursor:pointer;"
                                              aria-label="Example home icon" inline="false" title="Delete this row">
                                      delete_outline
                                    </mat-icon>
                                    <ng-container *ngIf="attribute.fieldTableValue.length>1 && !currentReport.forGranteeUse && !row.enteredByGrantee">
                                      <p class="anu-input m-0 text-center" style="background:#f4f4f4 !important;position:relative;top:0;">{{row.name}}</p>
                                    </ng-container>
                                    <ng-container *ngIf="attribute.fieldTableValue.length>1 && !currentReport.forGranteeUse && row.enteredByGrantee">
                                      <p class="anu-input m-0 text-center" style="background:#f4f4f4 !important;position:relative;top:0px;">{{row.name}}</p>
                                    </ng-container>
                                    <ng-container *ngIf="attribute.fieldTableValue.length===1 && !currentReport.forGranteeUse">
                                      <p class="anu-input m-0 text-center" style="background:#f4f4f4 !important;position:relative;top:0;">{{row.name}}</p>
                                    </ng-container>
                                    <ng-container *ngIf="attribute.fieldTableValue.length>1 && currentReport.forGranteeUse && !row.enteredByGrantee">
                                      <p class="anu-input m-0 text-center" style="background:#f4f4f4 !important;position:relative;top:0px;">{{row.name}}</p>
                                    </ng-container>
                                    <ng-container *ngIf="attribute.fieldTableValue.length>1 && currentReport.forGranteeUse && row.enteredByGrantee && row.status">
                                      <p class="anu-input m-0 text-center" style="background:#f4f4f4 !important;position:relative;top:-14px;">{{row.name}}</p>
                                    </ng-container>
                                    <ng-container *ngIf="attribute.fieldTableValue.length>1 && currentReport.forGranteeUse && row.enteredByGrantee && !row.status">
                                      <p class="anu-input m-0 text-center" style="background:#f4f4f4 !important;position:relative;top:0px;">{{row.name}}</p>
                                    </ng-container>
                                    <ng-container *ngIf="attribute.fieldTableValue.length===1 && currentReport.forGranteeUse && row.enteredByGrantee">
                                      <p class="anu-input m-0 text-center" style="background:#f4f4f4 !important;position:relative;top:0px;">{{row.name}}</p>
                                    </ng-container>
                                    <ng-container *ngIf="attribute.fieldTableValue.length===1 && currentReport.forGranteeUse && !row.enteredByGrantee">
                                      <p class="anu-input m-0 text-center" style="background:#f4f4f4 !important;position:relative;top:0px;">{{row.name}}</p>
                                    </ng-container>
                                  </td>
                                  <ng-container *ngFor="let column of row.columns,let j = index">
                                    <td style="border: 1px solid #e4e4e4;padding-top:0;" [width]="column.name==='Notes'?'20%':'12%'">
                                      <mat-form-field style="margin-top: 3px;" *ngIf="!currentReport.forGranteeUse">
                                        <input [id]="'data_'+i+'_'+j" *ngIf="!column.dataType && !row.enteredByGrantee" matInput [(ngModel)]="column.value" class="anu-input"
                                               [ngModelOptions]="{standAlone:true}" disabled readonly style="color:#212529;background:#f4f4f4 !important;">
                                        <input [id]="'data_'+i+'_'+j" *ngIf="!column.dataType && row.enteredByGrantee" matInput [(ngModel)]="column.value" class="anu-input"
                                               [ngModelOptions]="{standAlone:true}" readonly disabled style="color:#212529;background:#f4f4f4 !important;">
                                        <input [id]="'data_'+i+'_'+j" *ngIf="column.dataType==='date' && !row.enteredByGrantee" matInput [(ngModel)]="column.value" class="anu-input"
                                               [ngModelOptions]="{standAlone:true}" (click)="openDate(column,$event)" disabled readonly style="color:#212529;background:#f4f4f4 !important;">
                                        <input [id]="'data_'+i+'_'+j" *ngIf="column.dataType==='date' && row.enteredByGrantee" matInput [(ngModel)]="column.value" class="anu-input"
                                               [ngModelOptions]="{standAlone:true}" readonly disabled style="color:#212529;background:#f4f4f4 !important;">
                                        <input [id]="'data_'+i+'_'+j"  *ngIf="column.dataType==='currency' && column.name!=='Funds from Other Sources' && !row.enteredByGrantee" (blur)="showFormattedAmount($event)" #committedAmount type="number" matInput [(ngModel)]="column.value" class="anu-input text-right" disabled readonly style="color:#212529;background:#f4f4f4 !important;"
                                               [ngModelOptions]="{standAlone:true}">
                                        <p [id]="'label_'+i+'_'+j" *ngIf="column.dataType==='currency' && column.name!=='Funds from Other Sources' && !row.enteredByGrantee" #amountFormatted class="anu-input w-100 text-right" style="position:absolute;top:-1px;cursor: text;color:#212529;background:#f4f4f4 !important;">{{getFormattedCurrency(column.value)}}</p>
                                        <input [id]="'data_'+i+'_'+j"  *ngIf="column.dataType==='currency' && column.name!=='Funds from Other Sources' && row.enteredByGrantee"  #committedAmount type="number" matInput [(ngModel)]="column.value" class="anu-input text-right"
                                               [ngModelOptions]="{standAlone:true}" readonly disabled style="color:#212529;background:#f4f4f4 !important;">
                                        <p [id]="'label_'+i+'_'+j" *ngIf="column.dataType==='currency' && column.name!=='Funds from Other Sources' && row.enteredByGrantee" #amountFormatted class="anu-input w-100 text-right" style="position:absolute;top:-1px;cursor: text;background:#f4f4f4 !important;">{{getFormattedCurrency(column.value)}}</p>
                                        <input *ngIf="column.dataType==='currency' && column.name==='Funds from Other Sources'" type="number" matInput [(ngModel)]="column.value" class="anu-input text-right" readonly disabled style="color:#212529;background:#f4f4f4 !important;">
                                        <p [id]="'label_'+i+'_'+j" *ngIf="column.dataType==='currency' && column.name==='Funds from Other Sources'" class="anu-input w-100 text-right" style="position:absolute;top:-1px;background:#f4f4f4 !important;">{{getFormattedCurrency(column.value)}}</p>
                                      </mat-form-field>
                                      <mat-form-field style="margin-top: 3px;" *ngIf="currentReport.forGranteeUse">
                                        <input [id]="'data_'+i+'_'+j" *ngIf="!column.dataType  && !row.enteredByGrantee" matInput [(ngModel)]="column.value" class="anu-input"
                                               [ngModelOptions]="{standAlone:true}" readonly disabled style="color:#212529;background:#f4f4f4 !important;">
                                        <input [id]="'data_'+i+'_'+j" *ngIf="column.dataType==='date' && !row.enteredByGrantee" matInput [(ngModel)]="column.value" class="anu-input"
                                               [ngModelOptions]="{standAlone:true}" readonly disabled style="color:#212529;background:#f4f4f4 !important;">
                                        <input [id]="'data_'+i+'_'+j" *ngIf="!column.dataType  && row.enteredByGrantee && row.status" matInput [(ngModel)]="column.value" class="anu-input"
                                               [ngModelOptions]="{standAlone:true}">
                                               <input [id]="'data_'+i+'_'+j" *ngIf="!column.dataType  && row.enteredByGrantee && !row.status" matInput [(ngModel)]="column.value" class="anu-input" readonly disabled style="color:#212529;background:#f4f4f4 !important;"
                                               [ngModelOptions]="{standAlone:true}">
                                        <input [id]="'data_'+i+'_'+j" *ngIf="column.dataType==='date' && row.enteredByGrantee && row.status" matInput [(ngModel)]="column.value" class="anu-input"
                                               [ngModelOptions]="{standAlone:true}" (click)="openDate(column,$event)">
                                        <input [id]="'data_'+i+'_'+j" *ngIf="column.dataType==='date' && row.enteredByGrantee && !row.status" matInput [(ngModel)]="column.value" class="anu-input" readonly disabled style="color:#212529;background:#f4f4f4 !important;"
                                               [ngModelOptions]="{standAlone:true}" (click)="openDate(column,$event)">
                                        <mat-icon *ngIf="column.dataType==='date' && row.enteredByGrantee && row.status" (click)="openDate(column,$event)" style="transform: scale(0.5);position: absolute;right: 0;top:30%;cursor:pointer;">calendar_today</mat-icon>

                                        <input  *ngIf="column.dataType==='currency' && column.name!=='Funds from Other Sources'" type="number" matInput [(ngModel)]="column.value" class="anu-input text-right" readonly disabled style="color:#212529;background:#f4f4f4 !important;"
                                               [ngModelOptions]="{standAlone:true}">
                                        <p [id]="'label_'+i+'_'+j" *ngIf="column.dataType==='currency' && column.name!=='Funds from Other Sources'" class="anu-input w-100 text-right" style="position:absolute;top:-1px;cursor: text;background:#f4f4f4 !important;">{{getFormattedCurrency(column.value)}}</p>
                                        <input [id]="'data_'+i+'_'+j" *ngIf="column.dataType==='currency' && column.name==='Funds from Other Sources' && !row.enteredByGrantee" type="number" matInput [(ngModel)]="column.value" class="anu-input text-right"  readonly disabled style="color:#212529;background:#f4f4f4 !important;">
                                        <p [id]="'label_'+i+'_'+j" *ngIf="column.dataType==='currency' && column.name==='Funds from Other Sources' && row.enteredByGrantee && row.status" #amountFormatted (click)="showAmountInput($event)" class="anu-input w-100 text-right" style="position:absolute;top:-1px;cursor: text;">{{getFormattedCurrency(column.value)}}</p>
                                        <input [id]="'data_'+i+'_'+j" *ngIf="column.dataType==='currency' && column.name==='Funds from Other Sources' && row.enteredByGrantee && row.status" type="number" matInput [(ngModel)]="column.value" class="anu-input text-right" (blur)="showFormattedAmount($event)">
                                        <input [id]="'data_'+i+'_'+j" *ngIf="column.dataType==='currency' && column.name==='Funds from Other Sources' && row.enteredByGrantee && !row.status" type="number" matInput [(ngModel)]="column.value" class="anu-input text-right"  readonly disabled style="color:#212529;background:#f4f4f4 !important;">
                                        <p [id]="'data_'+i+'_'+j" *ngIf="column.dataType==='currency' && column.name==='Funds from Other Sources' && row.enteredByGrantee && !row.status" type="number" class="anu-input w-100 text-right" style="position:absolute;top:-1px;color:#212529;background:#f4f4f4 !important;">{{getFormattedCurrency(column.value)}}</p>
                                      </mat-form-field>
                                    </td>
                                  </ng-container>
                                </tr>
                              </ng-container>
                              </ng-container>
                              <div class="row"><div class="col-12">
                                <span *ngIf="currentReport.forGranteeUse" (click)="addDisbursementRow(attribute)" style="cursor:pointer;"><i class="fas fa-plus-circle text-green mr-1"></i>Add a row</span>
                              </div></div>
                              <!--tr *ngIf="getGrantDisbursementAttribute() && getGrantDisbursementAttribute().fieldTableValue.length>1" style="background:#f4f4f4;">
                                <td class="py-2" align="center" style="position: sticky; left: 0; z-index: 1;"><p  class="w-100" style="font-weight:600;">TOTALS:</p></td>
                                <td *ngFor="let column of getGrantDisbursementAttribute().fieldTableValue[0].columns,let j = index" valign="middle">
                                  <label class="text-right pr-3 my-0 w-100" *ngIf="column.dataType==='currency'"><b>{{getDisbursementTotals(j,attribute.fieldTableValue)}}</b></label>
                                </td>
                              </tr-->
                            </table>
                          </div>
                        </div>

                        <div class="col-sm-4 col-lg-8 text-left" *ngIf="attribute.fieldType==='kpi' && (currentReport.canManage && !currentReport.forGranteeUse)">
                          <mat-form-field>
                            <input matInput disabled placeholder="Grant Level Target:" style="background:#F0F1F0 !important;" class="anu-input" [value]="attribute.grantLevelTarget && (attribute.grantLevelTarget!==null)?attribute.grantLevelTarget:'N/A'">
                          </mat-form-field>
                        </div>
                        <div class="col-sm-4 col-lg-8 text-left" *ngIf="attribute.fieldType==='kpi' && (currentReport.canManage && currentReport.forGranteeUse)">
                          <mat-form-field>
                            <input matInput disabled placeholder="Grant Level Target:" style="background:#F0F1F0 !important;" class="anu-input" [value]="attribute.grantLevelTarget && (attribute.grantLevelTarget!==null)?attribute.grantLevelTarget:'N/A'">
                          </mat-form-field>
                          <!--label *ngIf="(currentReport.canManage && currentReport.forGranteeUse) || !currentReport.canManage">Grant Level Target/Goal:</label>
                          <p class="anu-input" *ngIf="(currentReport.canManage && currentReport.forGranteeUse) || !currentReport.canManage" style="background:#F0F1F0 !important;">{{attribute.grantLevelTarget}}</p-->
                        </div>
                        <div class="col-sm-4 col-lg-4 text-left" *ngIf="attribute.fieldType==='kpi'">
                          <mat-form-field>
                          <input class="anu-input" matInput placeholder="Frequency:" style="background:#F0F1F0 !important;" [value]="attribute.frequency==='Half-yearly'?'Half-Yearly':attribute.frequency==='adhoc'?'N/A':attribute.frequency | titlecase" readonly disabled>
                          </mat-form-field>
                        </div>


                        <div class="col-sm-4 col-lg-4 text-left" *ngIf="attribute.fieldType==='kpi'">
                          <mat-form-field>
                            <mat-label>Grant Level Achieved<sup>&nbsp;(1)</sup>:</mat-label>
                            <input matInput style="background:#F0F1F0 !important;" [value]="attribute.cumulativeActuals?attribute.cumulativeActuals:'N/A'" readonly disabled class="anu-input">
                          </mat-form-field>
                        </div>
                        <div class="col-sm-4 col-lg-4 text-left" *ngIf="attribute.fieldType==='kpi' && appComp.loggedInUser.organization.organizationType==='GRANTER' && (currentReport.canManage && !currentReport.forGranteeUse)">
                          <mat-form-field>
                            <input matInput [(ngModel)]="attribute.target" class="anu-input"

                                   [ngModelOptions]="{standAlone:true}"
                                   placeholder="Report Level Target:">
                          </mat-form-field>
                        </div>
                        <div class="col-sm-4 col-lg-4 text-left" *ngIf="attribute.fieldType==='kpi' && appComp.loggedInUser.organization.organizationType==='GRANTEE' && (currentReport.canManage && currentReport.forGranteeUse)">
                          <mat-form-field>
                            <input matInput placeholder="Report Level Target:" style="background:#F0F1F0 !important;" [value]="attribute.target?attribute.target:null" readonly disabled class="anu-input">
                          </mat-form-field>
                        </div>
                        <div class="col-sm-4 col-lg-4 text-left" *ngIf="attribute.fieldType==='kpi' && appComp.loggedInUser.organization.organizationType==='GRANTER' && (currentReport.canManage && !currentReport.forGranteeUse)">
                          <mat-form-field>
                          <input matInput placeholder="Report Level Accomplishment:" [value]="attribute.actualTarget?attribute.actualTarget:'To be filled by grantee organization'" readonly disabled style="background:#F0F1F0 !important;" class="anu-input">
                          </mat-form-field>
                        </div>
                        <div class="col-sm-4 col-lg-4 text-left" *ngIf="attribute.fieldType==='kpi' && appComp.loggedInUser.organization.organizationType==='GRANTEE' && (currentReport.canManage && currentReport.forGranteeUse)">
                          <mat-form-field>
                            <input matInput [(ngModel)]="attribute.actualTarget" class="anu-input"

                                   [ngModelOptions]="{standAlone:true}"
                                   placeholder="Report Level Accomplishment:">
                          </mat-form-field>
                        </div>

                        <!--<div class="col-sm-4 col-lg-4 text-left" *ngIf="attribute.fieldType==='kpi' && attribute.canEdit">
                          <mat-form-field>
                            <mat-label>Reporting Frequency</mat-label>
                            <mat-select [(ngModel)]="attribute.frequency"  class="anu-input"
                                        [ngModelOptions]="{standAlone:true}">
                              <mat-option value="none" aria-selected="true">&#45;&#45;Select type
                                of field&#45;&#45;
                              </mat-option>
                              <mat-option value="monthly">Monthly</mat-option>
                              <mat-option value="quarterly">Quarterly</mat-option>
                              <mat-option value="half-yearly">Half Yearly</mat-option>
                              <mat-option value="yearly">Yearly</mat-option>
                            </mat-select>

                          </mat-form-field>
                        </div>-->
                        <div class="col-sm-12 col-lg-12 text-left" *ngIf="attribute.fieldType==='multiline'">
                          <textarea [(ngModel)]="attribute.fieldValue" class="anu-input h-100 w-100"

                                    [ngModelOptions]="{standAlone:true}"
                                    ></textarea>
                        </div>
                        <div class="col-sm-12 col-lg-12 text-left" *ngIf="attribute.fieldType==='document'">
                          <div style="display:flex;align-items: baseline;" class="attachments-wrapper">
                            <div class="col-8 pl-0 pr-1">
                              <form class="example-form">
                                <mat-form-field class="example-chip-list">
                                  <mat-chip-list #chipList aria-label="Fruit selection">
                                    <!--<mat-chip
                                      *ngFor="let fruit of attribute.docs"
                                      [selectable]="selectable"
                                      [removable]="removable"
                                      (removed)="remove(attribute, fruit)">
                                      {{fruit.name}}
                                      <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
                                    </mat-chip>-->
                                    <button class="btn btn-sm btn-blue w-100" [matAutocomplete]="auto"><img src="./assets/img/library.svg" class="w-10 mr-2" style="width:24px;">Browse from library</button>
                                    <input id="templateLib_{{attribute.id}}" class="" style="max-width: 0; height: 0; padding: 0 !important; margin: 0;"
                                           #fruitInput
                                           [formControl]="myControl"
                                           [matAutocomplete]="auto"
                                           [matChipInputFor]="chipList"
                                           [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                           [matChipInputAddOnBlur]="addOnBlur">
                                  </mat-chip-list>
                                  <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected(attribute, $event)">
                                    <ng-container *ngFor="let doc of filteredOptions | async">
                                      <mat-option [value]="doc" [disabled]="checkIfSelected(doc)">
                                        {{doc.name}}
                                      </mat-option>
                                    </ng-container>

                                  </mat-autocomplete>
                                </mat-form-field>
                              </form>
                            </div>
                            <div class="col-4 pr-0">
                              <label for="attribute_fileupload_{{attribute.id}}" class="btn btn-sm btn-green w-100"><img src="./assets/img/computer.svg" class="w-10 mr-2" style="width:24px;">Browse from system</label>
                              <input id="attribute_fileupload_{{attribute.id}}" type="file" style="height:0;visibility:hidden;" multiple (change)="processSelectedFiles(section,attribute,$event)" accept=".pdf,.xls,.xlsx,.doc,.docx">
                            </div>
                          </div>
                          <mat-nav-list>
                            <ng-container *ngFor="let attachment of attribute.attachments">
                              <mat-list-item>
                                <a>
                                  <img src="./assets/img/trash.svg" (click)="deleteAttachment(attribute.id, attachment.id)" style="width: 16px;opacity: 0.75;">
                                </a>

                                <p id="fileAttachment_{{attachment.id}}" mat-line style="border-bottom: 1px solid #d4d4d4;padding-left: 0;">{{attachment.name + '.' + attachment.type}}</p>
                                <input id="attriute_{{attribute.id}}_attachment_{{attachment.id}}" mat-list-icon class="attachment-checkbox" type="checkbox" (change)="handleSelection(attribute.id,attachment.id)">
                              </mat-list-item>
                            </ng-container>
                            <mat-list-item *ngIf="attribute.attachments && attribute.attachments.length >0">

                              <button id="attachments_download_{{attribute.id}}" class="btn btn-sm btn-blue" disabled (click)="downloadSelection(attribute.id)">
                                Download Selected Documents
                              </button>
                            </mat-list-item>
                          </mat-nav-list>
                        </div>
                      </ng-container>
                      <div class="col-12" *ngIf="(currentReport.canManage && !currentReport.forGranteeUse)">
                        <div class="row mt-3">
                          <div class="col-6 text-left" *ngIf="attribute.fieldType==='kpi'">
                            <sup>(1) - Totals based on all approved reports for grant</sup>
                          </div>
                          <div class="col-6 text-right" *ngIf="attribute.fieldType==='kpi'">
                            <a [class]="i===0?'isDisabled':''" (click)="moveTo(section,attribute,i===0?null:section.attributes[i-1])"><img src="./assets/img/chevron-up.svg" class="w-10 mr-2" style="width:24px;"></a>
                            <a [class]="i===section.attributes.length-1?'isDisabled':''" (click)="moveTo(section,attribute,i===section.attributes.length-1?null:section.attributes[i+1])"><img src="./assets/img/chevron-down.svg" class="w-10 mr-2" style="width:24px;"></a>
                            <a><img src="./assets/img/Line.svg" class="w-10 mr-2" style="width:1px;"></a>
                            <a>
                              <img src="./assets/img/trash.svg" (click)="deleteFieldEntry(section.id,attribute.id,attribute.fieldName)" class="w-10 mr-2" style="width:24px;">
                            </a>
                          </div>
                          <div class="col-12 text-right" *ngIf="attribute.fieldType!=='kpi'">
                            <a [class]="i===0?'isDisabled':''" (click)="moveTo(section,attribute,i===0?null:section.attributes[i-1])"><img src="./assets/img/chevron-up.svg" class="w-10 mr-2" style="width:24px;"></a>
                            <a [class]="i===section.attributes.length-1?'isDisabled':''" (click)="moveTo(section,attribute,i===section.attributes.length-1?null:section.attributes[i+1])"><img src="./assets/img/chevron-down.svg" class="w-10 mr-2" style="width:24px;"></a>
                            <a><img src="./assets/img/Line.svg" class="w-10 mr-2" style="width:1px;"></a>
                            <a>
                              <img src="./assets/img/trash.svg" (click)="deleteFieldEntry(section.id,attribute.id,attribute.fieldName)" class="w-10 mr-2" style="width:24px;">
                            </a>
                          </div>
                        </div>
                      </div>
                      <div class="col-12" *ngIf="(currentReport.canManage && currentReport.forGranteeUse)">
                        <div class="row mt-3">
                          <div class="col-12 text-left" *ngIf="attribute.fieldType==='kpi'">
                            <sup>(1) - Totals based on all approved reports for grant</sup>
                          </div>
                        </div>
                      </div>
                    </div>
                  </ng-container>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div #createSectionModal class="modal fade" id="createSectionModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="createSectionLabel"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="fieldTitleInput" class="mat-form-field-label pull-left">Section Name:</label>
          <input id="sectionTitleInput" class="form-control" value="">
        </div>
      </div>
      <div class="">
        <button type="button" class="btn btn-primary pull-right"
                (click)="saveSection()">Done
        </button>
        <button type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>

      </div>
    </div>
  </div>
</div>
