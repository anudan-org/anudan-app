<div class="container-fluid text-left mt-5 pt-5 pl-2 pr-2 pb-2">
  <h5>{{currentSubmission.grant.name}}</h5>
  <div *ngIf="quantitativeKpisToSubmit || qualitativeKpisToSubmit || documentKpisToSubmit">
    <a class="btn btn-sm btn-outline-secondary" (click)="appComp.goToHome()"><i
        class="fa fa-home mr-2"></i>Home</a>
    <a class="btn btn-sm btn-outline-dark" (click)="appComp.goToGrantSummary()"><i
        class="fa fa-files-o mr-2"></i>Grant Summary</a>

      <div *ngFor="let act of actions" class="btn-group">
        <button class="btn btn-sm btn-primary"
                (click)="submitKpis(act.toStateId)">{{act.name}}</button>
      </div>
    <hr>
    <h4 class="text-center">Reporting for {{currentSubmission.title}}</h4>
    <div class="row bg-dark text-white mx-2 py-2 mb-2">
      <div class="col-sm-6 col-lg-6"><b>KPI</b></div>
      <div class="col-sm-2 col-lg-2 text-center"><b>Goal/Target</b></div>
      <div class="col-sm-2 col-lg-2 text-center"><b>Achieved</b></div>
      <div class="col-sm-2 col-lg-2"><b></b></div>
    </div>
      <div class="row mx-2" *ngFor="let kpiData of quantitativeKpisToSubmit">
        <div class="col-sm-6 col-lg-6"><b>{{kpiData.kpiDataTitle}}</b></div>
        <div class="col-sm-2 col-lg-2 text-center">{{kpiData.kpiDataGoal}}</div>
        <div class="col-sm-2 col-lg-2 text-center">
          <input *ngIf="currentSubmission.actionAuthorities.permissions.includes('MANAGE')"
                 id="data_id_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}"
                 value="{{kpiData.kpiDataActuals}}" class="form-control text-center">
          <input *ngIf="currentSubmission.actionAuthorities.permissions.includes('VIEW')"
                 id="data_id_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}"
                 value="{{kpiData.kpiDataActuals}}" class="form-control text-center" readonly>
        </div>
        <div class="col-sm-2 col-lg-2">
          <a data-toggle="modal" data-target="#notesModal"
             [attr.data-whatever]="currentSubmission.id+'_'+kpiData.kpiType+'_'+kpiData.kpiDataId">
            <i title="Notes" *ngIf="kpiData.kpiDataNote"
               id="icon_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}"
               class="fa fa-newspaper-o text-primary"></i>
            <i title="Notes" *ngIf="!kpiData.kpiDataNote"
               id="icon_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}"
               class="fa fa-newspaper-o"></i>

            <i class="fa fa-paperclip ml-2" title="Attachments"></i>

          </a>
          <input id="note_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}"
                 type="hidden" value="{{kpiData.kpiDataNote}}">
        </div>
      </div>
      <div class="row mx-2" *ngFor="let kpiData of qualitativeKpisToSubmit">
        <div class="col-sm-12 col-lg-12"><b>{{kpiData.kpiDataTitle}}</b></div>
        <div class="col-sm-10 col-lg-10">
          <textarea *ngIf="currentSubmission.actionAuthorities.permissions.includes('MANAGE')"
                    id="data_id_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}"
                    class="form-control w-100">{{kpiData.kpiDataActuals}}</textarea>
          <textarea *ngIf="currentSubmission.actionAuthorities.permissions.includes('VIEW')"
                    id="data_id_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}"
                    class="form-control w-100" readonly>{{kpiData.kpiDataActuals}}</textarea>
        </div>
        <div class="col-sm-2 col-lg-2">
          <a data-toggle="modal" data-target="#notesModal"
             [attr.data-whatever]="currentSubmission.id+'_'+kpiData.kpiType+'_'+kpiData.kpiDataId">
            <i title="Notes" *ngIf="kpiData.kpiDataNote"
               id="icon_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}"
               class="fa fa-newspaper-o text-primary"></i>
            <i title="Notes" *ngIf="!kpiData.kpiDataNote"
               id="icon_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}"
               class="fa fa-newspaper-o"></i>

            <i class="fa fa-paperclip ml-2" title="Attachments"></i>
          </a>
          <input id="note_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}"
                 type="hidden" value="{{kpiData.kpiDataNote}}">
        </div>

      </div>
      <div class="row mx-2" *ngFor="let kpiData of documentKpisToSubmit">
        <div id="doc_title_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}"
             class="col-sm-12 col-lg-12"><b>{{kpiData.kpiDataTitle}}</b></div>
        <div class="col-sm-10 col-lg-10">
          <div>
            <a *ngIf="kpiData.kpiDataActuals" target="_blank"
               href="/api/submission/{{currentSubmission.id}}/kpi/{{kpiData.kpiDataGrantKpiId}}/file">
              {{kpiData.kpiDataActuals}}
              <i *ngIf="kpiData.kpiDocType==='pdf'"
                 class="fa fa-file-pdf-o text-rose"></i>
              <i *ngIf="kpiData.kpiDocType==='jpg'" class="fa fa-file-image-o"></i>
              <i *ngIf="kpiData.kpiDocType==='jpeg'" class="fa fa-file-image-o"></i>
              <i *ngIf="kpiData.kpiDocType==='png'" class="fa fa-file-image-o"></i>
              <i *ngIf="kpiData.kpiDocType==='doc'" class="fa fa-file"></i>
            </a>
          </div>
          <label
              *ngIf="kpiData.kpiDataActuals && currentSubmission.actionAuthorities.permissions.includes('MANAGE')"
              for="data_id_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}">Upload
            new file</label>
          <label class="btn btn-sm btn-secondary text-white"
                 *ngIf="!kpiData.kpiDataActuals && currentSubmission.actionAuthorities.permissions.includes('MANAGE')"
                 for="data_id_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}">Upload
            file</label>
          <input style="visibility: hidden"
                 id="data_id_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}"
                 type="file" (change)="docChangeListener($event)">
          <input type="hidden"
                 id="doc_id_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}">
          <input type="hidden"
                 id="file_id_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}">
        </div>

        <div class="col-sm-2 col-lg-2">
          <a data-toggle="modal" data-target="#notesModal"
             [attr.data-whatever]="currentSubmission.id+'_'+kpiData.kpiType+'_'+kpiData.kpiDataId">
            <i title="Notes" *ngIf="kpiData.kpiDataNote"
               id="icon_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}"
               class="fa fa-newspaper-o text-primary"></i>
            <i title="Notes" *ngIf="!kpiData.kpiDataNote"
               id="icon_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}"
               class="fa fa-newspaper-o"></i>

            <i class="fa fa-paperclip ml-2" title="Attachments"></i>

          </a>
          <input id="note_{{currentSubmission.id}}_{{kpiData.kpiType}}_{{kpiData.kpiDataId}}"
                 type="hidden" value="{{kpiData.kpiDataNote}}">
        </div>

      </div>
  </div>
</div>

<div class="modal fade" id="notesModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
  <input id="noteId" type="hidden" value="">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add a note</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="message-text" class="col-form-label">Message:</label>
          <textarea class="form-control" id="message-text"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" (click)="saveNote()">Save</button>
      </div>
    </div>
  </div>
</div>

