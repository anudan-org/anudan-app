<div class="row anu-container">
    <div class="col-12">
        <p>
            <button class="btn btn-sm btn-green" (click)="createTemplate()">Create template</button>
        </p>
    </div>
    <div class="col-12" *ngIf="template">
        <mat-form-field>
            <input matInput [(ngModel)]="template.name" class="anu-input" placeholder="Template Name">
        </mat-form-field>
          <mat-checkbox [(ngModel)]="template._default" class="anu-input">Default?</mat-checkbox>
        <mat-form-field>
            <mat-select matInput [(ngModel)]="template.type" class="anu-input" placeholder="Template Type">
              <mat-option value="report">Report</mat-option>
              <mat-option value="grant">Grant</mat-option>
            </mat-select>
        </mat-form-field>
        <button (click)="addSection()" class="btn btn-sm btn-blue">Add Section</button>
        <ng-container *ngIf="template.sections">
            <div class="row grant-section p-3" *ngFor="let sec of template.sections"
                 style="border:1px solid #d4d4d4; background:#f6f6f6;">
                <div class="col-12">
                    <mat-form-field>
                        <input matInput [(ngModel)]="sec.name" class="anu-input" placeholder="Section Name">
                    </mat-form-field>
                    <button class="btn btn-sm btn-green" (click)="addAttribute(sec)">Add Attribute</button>
                    <ng-container *ngIf="sec.attributes">
                        <div class="row mx-5" *ngFor="let attr of sec.attributes">
                            <div class="col-6">
                                <mat-form-field>
                                    <input matInput [(ngModel)]="attr.name" class="anu-input" placeholder="Field Name">
                                </mat-form-field>
                            </div>
                            <div class="col-6">
                                <mat-form-field>
                                    <mat-select matInput [(ngModel)]="attr.type" class="anu-input"
                                                placeholder="Field Type"
                                                (ngModelChange)="handleTypeChange($event,attr)">
                                        <mat-option value="multiline">Mult-line</mat-option>
                                        <mat-option value="document">Document</mat-option>
                                        <mat-option value="kpi">KPI</mat-option>
                                        <mat-option value="table">Table</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <button class="btn btn-sm btn-green" *ngIf="attr.type==='table'">Create Table</button>
                            <ng-container *ngIf="attr.type==='table'">

                                    <table id="tablePlaceholder">
                                        <tr>
                                            <td width="20%"
                                                style="min-width:250px;position: sticky; left: 0; z-index: 1;background: rgb(244,244,244)">
                                               <button class="btn btn-sm btn-blue" (click)="addRow(attr)">Add Row</button>
                                               <button class="btn btn-sm btn-blue" (click)="addColumn(attr)">Add Column</button>
                                            </td>
                                            <ng-container
                                                    *ngFor="let column of attr.tableValue[0].columns, let i = index">

                                                <td style="border: 1px solid #e4e4e4;">

                                                    <mat-form-field>
                                                        <input id="column_{{column.id}}" matInput
                                                               [(ngModel)]="column.name" class="anu-input"
                                                               [ngModelOptions]="{standAlone:true}"
                                                               placeholder="Column description">
                                                    </mat-form-field>
                                                </td>

                                            </ng-container>
                                        </tr>
                                        <ng-container *ngFor="let row of attr.tableValue, let i = index">
                                            <tr>
                                                <td width="20%"
                                                    style="position: sticky; left: 0; z-index: 1;background: rgb(244,244,244)">
                                                    <mat-form-field>
                                    <textarea matInput [(ngModel)]="row.name" class="anu-input"
                                              [ngModelOptions]="{standAlone:true}"
                                              placeholder="Row description"></textarea>
                                                    </mat-form-field>
                                                </td>
                                            </tr>
                                        </ng-container>
                                    </table>

                            </ng-container>
                        </div>
                    </ng-container>
                </div>
            </div>
        </ng-container>
      <button class="btn btn-primary" (click)="saveTemplate()">Save Template</button>
    </div>

</div>
